---
layout: default
title: 使用地图 
grand_parent: 构建数据可视化
parent: 使用坐标和区域图
nav_order: 10
redirect_from:
  - /dashboards/maps/
---

# 使用地图

使用OpenSearch仪表板，您可以创建地图以可视化地理数据。OpenSearch允许您使用多层构建MAP可视化，并将数据组合到不同索引。您可以从不同的索引模式构建每一层。此外，您可以配置地图以在不同的缩放级别显示特定数据。OpenSearch Maps由OpenSearch Maps Service提供动力，该搜索地图服务使用向量图块呈现映射。

## 创建新地图

您可以从**地图** 或者**可视化** 通过执行以下步骤来工作流程：

- 从**地图** 工作流程，执行以下步骤：

  1.在顶部菜单栏上，转到**OpenSearch插件>地图**。
  1.选择**创建地图** 按钮。

- 从**可视化** 工作流程，执行以下步骤：

  1.在顶部菜单栏上，转到**OpenSearch仪表板>可视化**。
  1.选择**创建可视化** 按钮。
  1.在**新的可视化** 对话框，选择**地图**。

现在，您可以查看默认的OpenSearch BaseMap。

检查**默认地图** 图层配置，在**层** 地图左上方的面板，选择**默认地图**，如下图所示。

<img src="{{site.url}}{{site.baseurl}}/images/maps/maps-default.png" alt="Default map" width="900">

隐藏**层** 面板，选择面板鞋面中的崩溃（箭头）图标-右上角。
{: .tip}

## 图层设置

要更改默认地图设置，请选择**默认地图** 在里面**层** 控制板。在下面**图层设置**，您可以更改图层名称和描述，并为您的图层配置缩放级别和不透明度：

- **变焦级别**：默认情况下，在所有变焦级别上都可以看到一层。如果要使仅在一定范围的缩放级别上看到一层，则可以通过在文本框中输入或将范围滑块滑入所需值来指定缩放级别。

- **不透明度**：如果您的地图包含多层，则一层会掩盖另一层。在这种情况下，您可能需要降低顶层的不透明度，以便同时看到这两个层。

## 添加图层

在地图中添加一层**层** 面板，选择**添加图层** 按钮。这**添加图层** 对话框如下图所示。

<img src="{{site.url}}{{site.baseurl}}/images/maps/add-layer.png" alt="Add layer" width="450">

你可以加**基层** 或者**数据层** 到地图：

- A**基层** 用作基础。使用自己或第三-聚会图作为基础层，[将其添加为**自定义地图**](#adding-a-custom-map)。

- **数据层** 让您从各种数据源可视化数据。

## 添加自定义地图

OpenSearch支持Web Map Service（WMS）或Tile Map Service（TMS）自定义地图。要添加TMS自定义映射，请执行以下步骤：

1. 在里面**层** 面板，选择**添加图层** 按钮。
1. 来自**添加图层** 对话框，选择**基础层>自定义地图**。
    按照下一步**新层** 对话框，如下图所示。

    <img src ="{{site.url}}{{site.baseurl}}/images/maps/custom-map.png" alt ="Add custom map">

1. 在里面**自定义类型** 下拉列表，选择**瓷砖地图服务（TMS）**。
1. 输入TMS URL。
1. （可选）**TMS归因**，输入基础图的TMS归因。例如，如果您使用的是自定义基础图，请输入自定义地图名称。此名称将显示在较低的-地图的右角。
1. 选择**设置** 选项卡以编辑图层设置。
1. 在**姓名**。
1. （可选）在**描述**。
1. （可选）选择此层的变焦级别和不透明度。
1. 选择**更新** 按钮。

## 添加文档层

添加文档层使您可以可视化数据。您可以每个文档层添加一个索引模式。要查看多个索引模式，请创建多个层。

文档层可以显示GeoPoint和GeoShape文档字段。
{: .note}

以下示例假设您有`opensearch_dashboards_sample_data_flights` 已安装数据集。如果您没有安装此数据集，请执行以下步骤：

1. 在左上方，选择家庭图标。
1. 选择**添加示例数据**。
1. 在里面**示例飞行数据** 面板，选择**添加数据** 按钮。

添加文档层如下：

1. 在里面**层** 面板，选择**添加图层** 按钮。
1. 来自**添加图层** 对话框，选择**数据层>文档**。
1. 在**数据源**， 选择`opensearch_dashboards_sample_data_flights`。另外，您可以输入另一个索引模式进行可视化。
1. 在**地理空间领域**，选择一个在可视化中显示的地理空间场（地理位置或Geoshape）。在此示例中，选择`DestLocation`。
1. （可选）选择**风格** 选项卡以更改填充颜色，边框颜色，边框厚度或标记尺寸。
1. 选择**设置** 选项卡以编辑图层设置。
1. 进入`Flight destination` 在**姓名**。
1. 选择**更新** 按钮。
1. 要查看更多数据，-右角选择日历图标下拉列表，然后在下面**快速选择**， 选择**最近15天** 并选择**申请** 按钮。

如下图所示，您应该看到飞行目的地数据。

<img src="{{site.url}}{{site.baseurl}}/images/maps/new-layer.png" alt="Flight destination map">

## 过滤数据

要在索引中显示数据子集，请过滤数据。您可以在图层级别过滤数据，也可以在地图上绘制形状以在全球范围内过滤所有图层数据。

### 在层级别过滤数据

要在图层级别过滤数据，请选择图层并向其添加过滤器。

以下示例显示了如何过滤飞行目的地数据以仅显示美国目的地：

1. 在里面**层** 面板，选择**飞行目的地**。
1. 选择**过滤器**。
1. 选择**添加过滤器**。
1. 在**编辑过滤器**， 选择**德国人** 在**场地**。
1. 在**操作员**， 选择**是**。
1. 在**价值**， 选择**我们**。
1. 选择**节省** 按钮。
1. 选择**更新** 按钮。

对于大型数据集，您可能需要避免为完整地图加载数据。要仅加载特定地理区域的数据，请选择**仅在地图范围内请求数据**。
{: .tip}

### 绘制形状以过滤数据

您可以通过绘画在全球过滤数据[形状]({{site.url}}{{site.baseurl}}/field-types/geo-shape) 在地图上。要在地图上绘制矩形或多边形，请执行以下步骤：

1. 选择**长方形** 或者**多边形** 图标位于地图的右侧。
1. 在里面**过滤标签** 字段，输入过滤器的名称。
1. 选择一种空间关系类型。默认情况下，**相交** 选择。看[空间关系]({{site.url}}{{site.baseurl}}/query-dsl/geo-and-xy/xy#spatial-relations) 有关空间关系类型的更多信息。
1. 选择**绘制矩形** 或者**绘制多边形** 按钮。
1. 在您要选择的地图区域上绘制形状：
  - 对于矩形，选择地图上的任何起点（此点成为矩形顶点）。然后将悬停（不要将其拖动）到地图上的另一个点并选择它（该点变成相反的顶点）。
  - 对于多边形，选择地图上的任何起点（此点变为多边形顶点），然后将悬停（不要拖动）到每个后续顶点，然后选择该点。最后，确保再次选择起点以关闭多边形，如下图所示。

<img src="{{site.url}}{{site.baseurl}}/images/maps/draw-shape.png" alt="Drawing a polygon on a map">

### 禁用形状滤波器以作为地图层

默认情况下，将形状过滤器全球应用于地图上的所有层。如果要禁用形状过滤器以获取地图层，请执行以下步骤：
1. 从**层** 控制板。
1. 在里面**过滤器** 部分，取消选择**应用全球过滤器**。
1. 选择**更新** 按钮。

### 修改现有形状过滤器

要修改现有的形状过滤器，请在地图上方左上方选择过滤器。您可以在现有过滤器上执行以下操作：

- **编辑过滤器**：更改过滤器名称或修改形状的坐标。
- **排除结果**：否定过滤器，即显示所有数据点_except_滤波器应用的那些。
- **暂时禁用**：禁用过滤器，直到您选择**关于-使能够**。
- **删除**：完全卸下过滤器。

## 使用工具提示可视化其他数据

文档层显示地图上的GeoPoint和Geoshape文档字段作为地图上的位置。为了向位置添加更多信息，您可以使用工具提示。例如，您可能需要在此处显示飞行延迟，目的地天气和目的地国家信息**飞行目的地** 层。执行以下步骤以配置工具提示以显示其他数据：

1. 在里面**层** 面板，选择**飞行目的地**。
1. 选择**工具提示**。
1. 选择**显示工具提示** 复选框。
1. 在里面**工具提示字段** 下拉列表，选择要显示的字段。在此示例中，选择`FlightDelay`，，，，`DestWeather`， 和`DestCountry`。
1. 选择**更新** 按钮。

要查看工具提示，请将悬停在您感兴趣的地理点上。一个工具提示可以显示许多数据点。例如，在**飞行目的地** 层有多个目的地城市的飞行。要在航班上铺平，请选择您感兴趣的城市并使用工具提示中的箭头，如下图所示。

<img src="{{site.url}}{{site.baseurl}}/images/maps/tooltip.png" alt="Flight destination tooltip" width="450">

如果地图上的点包含来自多层的数据，则一个工具提示可以显示多层的数据。要查看所有层，请选择**所有层**。要选择特定图层，请在工具提示层选择面板中选择图层名称，如下图所示。

<img src="{{site.url}}{{site.baseurl}}/images/maps/layer-selection-panel.png" alt="Tooltip with a layer selection panel" width="450">

## 将标签添加到层

将标签添加到一层中，您可以在地图上可视化其他数据。例如，您可能希望看到**飞行目的地** 层。执行以下步骤将标签添加到**飞行目的地** 层：

1. 在里面**层** 面板，选择**飞行目的地**。
1. 在里面**风格** 选项卡，选择**添加标签** 复选框。
1. 您可以选择根据固定文本添加标签到图层中的所有数据点，也可以将字段值作为标签文本使用。
  - 添加固定-文字标签，下**标签文字**， 选择**固定的** 并输入您所需的标签文本。
  - 要根据字段值添加标签，**标签文字**， 选择**场值** 并选择字段名称。在此示例中，选择`OriginWeather`。
1. （可选）更改标签尺寸，颜色，边框颜色或边框宽度。
1. 选择**更新** 按钮。

如下图所示，在地图上可见具有原始天气的标签，并添加到工具提示中。

<img src="{{site.url}}{{site.baseurl}}/images/maps/label.png" alt="Label based on field type added to map and tooltips" width="450">

## 重新排序，隐藏和删除层

这**层** 面板可让您重新排序，隐藏和删除图层：

- 地图上的层彼此堆叠。要重新排序层，请使用层名称旁边的车把（两个水平线）图标将图层拖到所需的位置。

- 如果您想隐藏一层，请选择图层名称旁边的show/hide（眼）图标。切换显示/隐藏图标以再次显示图层。

- 要删除图层，请选择图层名称旁边的删除（垃圾桶）图标。

## 真实的刷新数据-时间数据集

如果您想可视化真实-时间数据集（将图层添加到地图上）执行以下步骤来设置刷新间隔：

1. 在鞋面中选择日历图标-右上角。
1. 在下面**刷新每个**，选择或输入刷新间隔（例如，1秒）。
1. 选择**开始** 按钮。

<img src="{{site.url}}{{site.baseurl}}/images/maps/refresh.png" alt="Refreshing a map" width="450">

## 保存地图

要保存使用您设置的所有层的地图，请执行以下步骤：

1. 选择**节省** upper-右上角。
1. 在里面**保存地图** 对话框，输入地图名称**标题** 文本框。
1. （可选）**描述** 文本框，输入地图描述。
1. 选择**节省** 按钮。

要打开保存的地图，请选择**地图** 在上部-左角。显示了保存的地图列表。

## 将地图添加到仪表板

您可以通过执行以下步骤将新的或现有的地图添加到新的或现有的仪表板：

- 要在新的仪表板中添加地图，请首先创建仪表板，如下所示：

  1.在顶部菜单栏上，转到**OpenSearch仪表板>仪表板**。
  1.选择**创建仪表板** 按钮。
  1.选择**创建新的** 按钮。

- 要向现有仪表板添加地图，请首先打开仪表板，如下所示：
  1.在顶部菜单栏上，转到**OpenSearch仪表板>仪表板**。
  1.选择要从列表中打开的仪表板。
  1.在上部-右角，选择**编辑**。

打开仪表板后，您可以向其添加新的或现有的地图。

### 添加现有地图

1. 从顶部菜单中选择**添加**。
1. 在里面**类型** 下拉列表，选择**地图**。
1. 选择要从列表中添加的地图。

### 添加新地图

1. 从顶部菜单中选择**创建新的** 按钮。
1. 在里面**新的可视化** 对话框，选择**地图**。
1. 通过添加基础图，图层或工具提示来编辑默认地图。
1. 在上部-右角，选择**节省** 按钮。
1. 在里面**保存地图** 对话框，输入**标题** 和可选**描述** 地图。
1. 选择**保存后添加到仪表板** （默认情况下选择此选项）。
1. 选择**保存并返回** 按钮。

## 从仪表板编辑地图

1. 在仪表板中，选择上部的齿轮图标-您要编辑的地图的右角。
1. 选择**编辑地图**。
1. 编辑地图。
1. 在上部-右角，选择**节省** 按钮。
1. 在里面**保存地图** 对话，选择**保存并返回** 按钮

